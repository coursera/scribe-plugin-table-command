define(function(){return function(e){function n(o){if(t[o])return t[o].exports;var r=t[o]={exports:{},id:o,loaded:!1};return e[o].call(r.exports,r,r.exports,n),r.loaded=!0,r.exports}var t={};return n.m=e,n.c=t,n.p="",n(0)}([function(e,n,t){var o=t(1),r=t(2);e.exports=function(){return function(e){function n(n){for(;n&&!e.element.isBlockElement(n);)n=n.parentNode;return n}function t(n){if(13===n.keyCode){var t=new e.api.Selection,o=t.range,i=o.endContainer,l=r.findTable(e,i),a=r.findTableCell(e,i),d=Array.prototype.indexOf.call(e.el.childNodes,l)+1,c=null;a&&(n.preventDefault(),c=document.createElement("p"),l.nextSibling?e.el.insertBefore(c,l.nextSibling):e.el.appendChild(c),o.setStart(e.el.childNodes[d],0),o.collapse(!0),t.selection.removeAllRanges(),t.selection.addRange(o))}}function i(n){var t=n.target||n.toElement;if(t){var o=r.findTableCell(e,t),i=r.findTable(e,o);i&&(n.preventDefault(),a.show(i,o))}}var l=new e.api.Command("insertTable"),a=new o(e);l.nodeName="TABLE",l.execute=function(){var t=r.createTable(3,3);e.transactionManager.run(function(){var o=new e.api.Selection,i=n(o.range.endContainer),l=i.nextSibling;l?e.el.insertBefore(t,l):e.el.appendChild(t);var a=t.childNodes[0],d=a.childNodes[0],c=d.childNodes[0];r.select(e,c)})},l.queryState=function(){var n=new e.api.Selection;return n.getContaining(function(e){return e.nodeName===this.nodeName}.bind(this))},l.queryEnabled=function(){return!0},e.el.addEventListener("keydown",t),e.el.addEventListener("contextmenu",i),e.commands.table=l}}},function(e,n,t){t(3);var o=t(2),r=[{id:0,text:"Insert row above"},{id:1,text:"Insert row below"},{id:2,text:"Insert column left"},{id:3,text:"Insert column right"},{id:4,text:"Delete row"},{id:5,text:"Delete column"},{id:6,text:"Delete table"}],i="scribe-table-context-menu",l="scribe-table-context-menu-action",a=function(e){for(var n=0,t=0;e;)n+=e.offsetTop,t+=e.offsetLeft,e=e.offsetParent;return{top:n,left:t}},d=function(e){return this.show=function(e,n){this.hide();var t=document.createElement("div"),o=a(n);t.className=i,t.style.top=o.top+20+"px",t.style.left=o.left+20+"px",r.forEach(function(o){var r=document.createElement("div");r.className=l,r.innerText=o.text,r.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation(),this.handleAction(e,n,o)}.bind(this)),t.appendChild(r)}.bind(this)),document.body.appendChild(t),document.addEventListener("click",this.hide)},this.hide=function(){var e=document.getElementsByClassName(i)[0];e&&e.parentNode.removeChild(e),document.removeEventListener("click",this.hide)},this.handleAction=function(n,t,r){var i=o.findCellPosition(n,t);switch(this.hide(),r.id){case 0:o.insertRow(e,n,i.rowIndex);break;case 1:o.insertRow(e,n,i.rowIndex+1);break;case 2:o.insertColumn(e,n,i.columnIndex);break;case 3:o.insertColumn(e,n,i.columnIndex+1);break;case 4:o.removeRow(e,n,i.rowIndex);break;case 5:o.removeColumn(e,n,i.columnIndex);break;case 6:o.removeTable(e,n)}},this};e.exports=d},function(e){var n={createTableCell:function(){var e=document.createElement("td");return e},createTableRow:function(e){for(var t=document.createElement("tr"),o=0;e>o;o++)t.appendChild(n.createTableCell());return t},createTable:function(e,t){for(var o=document.createElement("table"),r=document.createElement("tbody"),i=0;e>i;i++)r.appendChild(n.createTableRow(t));return o.appendChild(r),o},getColumnCount:function(e){var n=e.childNodes[0],t=n.childNodes;return t[0].childNodes.length},getRowCount:function(e){var n=e.childNodes[0];return n.childNodes.length},findTable:function(e,n){for(;n&&n!==e.el&&"TABLE"!==n.nodeName;)n=n.parentNode;return n&&"TABLE"!==n.nodeName&&(n=null),n},findTableCell:function(e,n){for(;n&&n!==e.el&&"TD"!==n.nodeName;)n=n.parentNode;return n&&"TD"!==n.nodeName&&(n=null),n},findCellPosition:function(e,n){var t=e.childNodes[0],o=Array.prototype.slice.call(t.childNodes),r={rowIndex:-1,columnIndex:-1};return o.every(function(e,t){var o=Array.prototype.slice.call(e.childNodes);return o.every(function(e,o){return e===n?(r={rowIndex:t,columnIndex:o},!1):!0}),-1!==r.rowIndex?!1:!0}),r},insertRow:function(e,t,o){var r=n.getColumnCount(t),i=t.childNodes[0],l=i.childNodes[o],a=n.createTableRow(r);e.transactionManager.run(function(){i.insertBefore(a,l),this.select(e,a.childNodes[0])}.bind(this))},removeRow:function(e,t,o){if(1===this.getRowCount(t))return void this.removeTable(e,t);var r=t.childNodes[0],i=r.childNodes[o];e.transactionManager.run(function(){r.removeChild(i),o>=n.getRowCount(t)&&o--,this.select(e,r.childNodes[o].childNodes[0])}.bind(this))},insertColumn:function(e,t,o){var r=t.childNodes[0],i=Array.prototype.slice.call(r.childNodes);e.transactionManager.run(function(){i.forEach(function(e){var t=n.createTableCell();e.insertBefore(t,e.childNodes[o])}),this.select(e,r.childNodes[0].childNodes[o])}.bind(this))},removeColumn:function(e,n,t){var o=this.getColumnCount(n),r=n.childNodes[0],i=Array.prototype.slice.call(r.childNodes);return 1===o?void this.removeTable(e,n):void e.transactionManager.run(function(){i.forEach(function(e){e.removeChild(e.childNodes[t])}),this.select(e,r.childNodes[0].childNodes[0])}.bind(this))},removeTable:function(e,n){e.transactionManager.run(function(){e.el.removeChild(n),this.select(e,e.el.childNodes[0])}.bind(this))},select:function(e,n){var t=new e.api.Selection;t.range.setStart(n,0),t.range.collapse(!0),t.selection.removeAllRanges(),t.selection.addRange(t.range)}};e.exports=n},function(){}])});